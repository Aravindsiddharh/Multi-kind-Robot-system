


map_server:
  ros__parameters:
    yaml_filename: ""  # Will be overridden by launch file
    use_sim_time: True
    frame_id: "map"
    topic_name: "map"
    
# amcl:
#   ros__parameters:
#     alpha1: 0.2
#     alpha2: 0.2
#     alpha3: 0.2
#     alpha4: 0.2
#     alpha5: 0.2
#     base_frame_id: "base_link"
#     introspection_mode: "disabled"
#     beam_skip_distance: 0.5
#     beam_skip_error_threshold: 0.9
#     beam_skip_threshold: 0.3
#     do_beamskip: false
#     global_frame_id: "map"
#     lambda_short: 0.1
#     laser_likelihood_max_dist: 2.0
#     laser_max_range: 100.0
#     laser_min_range: -1.0
#     laser_model_type: "likelihood_field"
#     max_beams: 60
#     max_particles: 2000
#     min_particles: 500
#     odom_frame_id: "odom"
#     pf_err: 0.05
#     pf_z: 0.99
#     recovery_alpha_fast: 0.0
#     recovery_alpha_slow: 0.0
#     resample_interval: 1
#     robot_model_type: "nav2_amcl::DifferentialMotionModel"
#     save_pose_rate: 0.5
#     sigma_hit: 0.2
#     tf_broadcast: true
#     transform_tolerance: 1.0
#     update_min_a: 0.2
#     update_min_d: 0.25
#     z_hit: 0.5
#     z_max: 0.05
#     z_rand: 0.5
#     z_short: 0.05
#     scan_topic: scan
#     map_topic: /map
#     set_initial_pose: false
#     always_reset_initial_pose: false
#     first_map_only: false
#     initial_pose:
#       x: 0.0
#       y: 0.0
#       z: 0.0
#       yaw: 0.0




amcl:
  ros__parameters:
    # Motion model noise (reduce if odometry is good)
    alpha1: 0.05
    alpha2: 0.05
    alpha3: 0.05
    alpha4: 0.05
    alpha5: 0.05

    base_frame_id: "base_link"
    introspection_mode: "disabled"

    # Beam skipping
    beam_skip_distance: 0.5
    beam_skip_error_threshold: 0.9
    beam_skip_threshold: 0.3
    do_beamskip: false

    global_frame_id: "map"
    odom_frame_id: "odom"

    # Sensor model
    laser_model_type: "likelihood_field"
    laser_likelihood_max_dist: 2.0
    laser_max_range: 100.0
    laser_min_range: -1.0
    max_beams: 120        # was 60

    # Particle filter
    min_particles: 300    # was 500
    max_particles: 1000   # was 2000
    pf_err: 0.05
    pf_z: 0.99
    resample_interval: 1

    # Recovery (keep off unless you see divergence)
    recovery_alpha_fast: 0.0
    recovery_alpha_slow: 0.0

    robot_model_type: "nav2_amcl::DifferentialMotionModel"

    # Pose handling
    save_pose_rate: 0.5
    set_initial_pose: false
    always_reset_initial_pose: false
    first_map_only: false
    initial_pose:
      x: 0.0
      y: 0.0
      z: 0.0
      yaw: 0.0

    # Update frequency thresholds (more frequent updates â†’ smoother laser overlay)
    update_min_a: 0.1     # was 0.2
    update_min_d: 0.1     # was 0.25

    # Laser model weights (more reliance on real obstacles)
    z_hit: 0.8            # was 0.5
    z_rand: 0.2           # was 0.5
    z_short: 0.05
    z_max: 0.05
    sigma_hit: 0.1        # was 0.2

    # Other
    lambda_short: 0.1
    tf_broadcast: true
    transform_tolerance: 1.0
    scan_topic: scan
    map_topic: /map

















# amcl:
#   ros__parameters:
#     # frames
#     global_frame_id: "map"
#     base_frame_id: "base_link"
#     odom_frame_id: "odom"
#     tf_broadcast: true
#     transform_tolerance: 0.5

#     # sensor
#     scan_topic: scan
#     laser_model_type: "likelihood_field"
#     laser_likelihood_max_dist: 2.5
#     laser_max_range: 100.0
#     laser_min_range: 0.05
#     max_beams: 180

#     # particle filter (stable defaults)
#     min_particles: 600
#     max_particles: 1200
#     kld_err: 0.02
#     kld_z: 0.99
#     resample_interval: 2

#     # update thresholds (more frequent updates, but smoothed by resampling)
#     update_min_d: 0.1
#     update_min_a: 0.1

#     # motion model (tune to odom quality)
#     alpha1: 0.05
#     alpha2: 0.05
#     alpha3: 0.05
#     alpha4: 0.05
#     alpha5: 0.05
#     robot_model_type: "nav2_amcl::DifferentialMotionModel"

#     # laser model weights
#     z_hit: 0.85
#     z_rand: 0.15
#     z_short: 0.05
#     z_max: 0.05
#     sigma_hit: 0.15

#     # beam skip (enabled, tuned)
#     do_beamskip: true
#     beam_skip_distance: 0.5
#     beam_skip_threshold: 0.25
#     beam_skip_error_threshold: 0.85

#     # misc
#     save_pose_rate: 0.5
#     map_topic: /map
#     set_initial_pose: false
#     always_reset_initial_pose: false
